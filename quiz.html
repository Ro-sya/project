<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Проходження тесту</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="topbar"><h1>Проходження тесту</h1></header>

  <main class="container">
    <h2 id="quiz-name"></h2>
    <form id="quiz-form"></form>
    <button id="submit" class="btn">Завершити</button>
  </main>

  <script src="script.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const name = params.get('quiz');
    const quiz = StorageService.findValue('quizzes', q => q.name === name, true);

    if (!quiz) {
      document.body.innerHTML = '<p style="padding:1em;">Тест не знайдено</p>';
    } else {
      document.getElementById('quiz-name').textContent = quiz.name;
      const form = document.getElementById('quiz-form');

      quiz.questions.forEach((q, qi) => {
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `<p><strong>${qi + 1}.</strong> ${escapeHtml(q.text)}</p>`;
        q.options.forEach((opt, oi) => {
          div.innerHTML += `
            <label><input type="checkbox" name="q${qi}" value="${oi}"> ${escapeHtml(opt.text)}</label><br>
          `;
        });
        form.appendChild(div);
      });

      document.getElementById('submit').onclick = () => {
        let score = 0;
        quiz.questions.forEach((q, qi) => {
          const checked = [...document.querySelectorAll(`input[name="q${qi}"]:checked`)];
          checked.forEach(c => {
            const opt = q.options[c.value];
            if (opt.isCorrect) score++;
          });
        });
        const timestamp = new Date().toISOString();
        StorageService.addValue('results', { quizName: quiz.name, timestamp, summary: `${score}/${quiz.questions.length}` }, true);
        location.href = `result.html?ts=${encodeURIComponent(timestamp)}`;
      };
    }
  </script>
</body>
</html>